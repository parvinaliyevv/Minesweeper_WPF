<Window x:Class="Minesweeper.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="16"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Title="Minesweeper" MinHeight="600" MinWidth="800" WindowStyle="None" AllowsTransparency="True" mc:Ignorable="d">

    <Grid>

        <Popup Placement="Center" IsOpen="{Binding GameOver, Mode=TwoWay}">
            <Button Command="{Binding ResetGameCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Self}}" Content="Retry"/>
        </Popup>

        <Grid>

            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="8*"/>
            </Grid.RowDefinitions>

            <DockPanel MouseDown="WindowMove_MouseDown" Background="#FF64D615">

                <ComboBox DockPanel.Dock="Left" SelectedItem="{Binding GameDifficulty, Mode=OneWayToSource}">

                    <ComboBox.SelectedIndex>1</ComboBox.SelectedIndex>
                    <ComboBox.Margin>20 10 0 10</ComboBox.Margin>

                    <ComboBoxItem Content="Easy"/>
                    <ComboBoxItem Content="Medium"/>
                    <ComboBoxItem Content="Hard"/>
                    <ComboBoxItem Content="Custom"/>

                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectionChanged">
                            <i:InvokeCommandAction Command="{Binding DifficultyChangedCommand}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>

                </ComboBox>

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Margin="0, 0, 5, 0">
                    <Button Height="auto" Width="auto" Margin="5" Command="{Binding SoundOffCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Self}}">
                        <materialDesign:PackIcon Kind="Music" MinHeight="30" MinWidth="50"/>
                    </Button>
                    <Button Height="auto" Width="auto" Margin="5" Command="{Binding ResetGameCommand}" CommandParameter="{Binding RelativeSource={RelativeSource Self}}">
                        <materialDesign:PackIcon Kind="Refresh" MinHeight="30" MinWidth="50"/>
                    </Button>
                    <Button Height="auto" Width="auto" Margin="5" Click="CloseApplication_ButtonClicked">
                        <materialDesign:PackIcon Kind="Close" MinHeight="30" MinWidth="50"/>
                    </Button>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Image VerticalAlignment="Center" Source="/Views/Flag.png" Height="40" Width="50"/>
                    <TextBlock VerticalAlignment="Center"  Text="{Binding FlagCount, Mode=TwoWay}"/>
                    <Image Margin="30, 0, 0, 0" VerticalAlignment="Center"  Source="/Views/Clock.png" Height="40" Width="50"/>
                    <TextBlock VerticalAlignment="Center" Text="{Binding GameTimer.ViewTime, Mode=TwoWay}"/>
                </StackPanel>

            </DockPanel>

            <ItemsControl Grid.Row="1" ItemsSource="{Binding Matrix, Mode=TwoWay}" BorderThickness="1.45" BorderBrush="DimGray">

                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Rows="{Binding Rows, Mode=TwoWay}" Columns="{Binding Columns, Mode=TwoWay}"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Style="{Binding }" Content="{Binding Content}" Background="{Binding Background}" IsHitTestVisible="{Binding IsEnable, Mode=TwoWay}" Grid.Row="{Binding Row}" Grid.Column="{Binding Column}">
                            <Button.InputBindings>
                                <MouseBinding Command="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=DataContext.LeftClickCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Button, Mode=FindAncestor}}" Gesture="LeftClick"/>
                                <MouseBinding Command="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=DataContext.RightClickCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Button, Mode=FindAncestor}}" Gesture="RightClick"/>
                            </Button.InputBindings>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>

            </ItemsControl>

        </Grid>

    </Grid>

</Window>
